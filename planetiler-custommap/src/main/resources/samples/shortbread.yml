schema_name: Shortbread
schema_description: A basic, lean, general-purpose vector tile schema for OpenStreetMap data. See https://shortbread.geofabrik.de/
attribution: <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>
sources:
  ocean:
    type: shapefile
    url: https://osmdata.openstreetmap.de/download/water-polygons-split-3857.zip
  admin_points:
    type: shapefile
    url: https://shortbread.geofabrik.de/shapefiles/admin-points-4326.zip
  osm:
    type: osm
    url: geofabrik:massachusetts
layers:

#  Water

- name: ocean
  features:
  - source: ocean
    geometry: polygon

- name: water_polygons
  features:
  - source: osm
    geometry: polygon
    min_zoom: 4
    include_when: &water_filter
      natural:
      - glacier
      - water
      waterway:
      - riverbank
      - dock
      - canal
      landuse:
      - reservoir
      - basin
    zoom_override: &water_zoom
    - min: 10
      tag:
        waterway:
        - dock
        - canal
    attributes:
    - key: kind
      type: match_value

- name: water_polygons_labels
  features:
  - source: osm
    geometry: polygon_centroid
    min_zoom: 14
    include_when: *water_filter
    exclude_when:
      name: ''
    zoom_override: *water_zoom
    attributes:
    - key: kind
      type: match_value
    - key: name
    - key: name_en
      tag_value: name:en
    - key: name_de
      tag_value: name:de

- name: water_lines
  features:
  - source: osm
    geometry: line
    min_zoom: 9
    # TODO rivers and canals min length=0.25px
    include_when:
      waterway:
      - canal
      - river
      - stream
      - ditch
    zoom_override:
    - min: 14
      tag:
        waterway:
        - stream
        - ditch
    attributes:
    - key: kind
      type: match_value

- name: water_line_labels
  features:
  - source: osm
    geometry: line
    min_zoom: 12
    # TODO rivers and canals min length=0.25px
    include_when:
      waterway:
      - canal
      - river
      - stream
      - ditch
    exclude_when:
      name: ''
    zoom_override:
    - min: 14
      tag:
        waterway:
        - stream
        - ditch
    attributes:
    - key: kind
      type: match_value
    - key: name
    - key: name_en
      tag_value: name:en
    - key: name_de
      tag_value: name:de

##  Countries, States, Cities
# TODO boundaries
# TODO boundary_labels
# TODO place_labels

##  Land Use, Land Cover, Buildings
- name: land
  features:
  - source: osm
    geometry: polygon
    min_zoom: 11
    include_when:
      amenity:
      - grave_yard
      landuse:
      - allotments
      - brownfield
      - cemetery
      - commercial
      - farmland
      - farmyard
      - forest
      - grass
      - greenfield
      - greenhouse_horticulture
      - industrial
      - landfill
      - meadow
      - orchard
      - plant_nursery
      - quarry
      - railway
      - recreation_ground
      - residential
      - retail
      - village_green
      - vineyard
      leisure:
      - garden
      - golf_course
      - miniature_golf
      - park
      - playground
      natural:
      - bare_rock
      - beach
      - grassland
      - heath
      - sand
      - scree
      - scrub
      - shingle
      - wood
      wetland:
      - bog
      - marsh
      - string_bog
      - swamp
      - wet_meadow
    zoom_override:
    - min: 7
      tag:
        natural: wood
        landuse: forest
    - min: 10
      tag:
        landuse:
        - brownfield
        - commercial
        - farmland
        - farmyard
        - greenfield
        - industrial
        - landfill
        - railway
        - residential
        - retail
        natural:
        - beach
        - sand
    - min: 13
      tag:
        amenity: grave_yard
        natural: wood
        landuse: cemetery
    attributes:
    - key: kind
      value: "${match_value == 'forest' ? 'wood' : match_value}"

- name: sites
  features:
  - source: osm
    geometry: polygon
    min_zoom: 14
    include_when:
      military: danger_area
      leisure: sports_center
      landuse: construction
      amenity:
      - university
      - hospital
      - prison
      - parking
      - bicycle_parking
    attributes:
    - key: kind
      type: match_value
      # TODO label: name ?

- name: buildings
  features:
  - source: osm
    geometry: polygon
    min_zoom: 14
    include_when:
      building: __any__
    exclude_when:
      building: no

- name: addresses
  features:
  - source: osm
    geometry: polygon_centroid_if_convex
    min_zoom: 14
    include_when: &address_filter
      addr:housenumber: __any__
      addr:housename: __any__
    attributes: &address_attributes
    - key: name
      tag_value: addr:housename
    - key: number
      tag_value: addr:housenumber
  - source: osm
    geometry: point
    min_zoom: 14
    include_when: *address_filter
    attributes: *address_attributes

##  Streets and Transport
- name: streets
  features:
  - source: osm
    geometry: line
    min_zoom: 13
    #  TODO   min_tile_cover_size: 0
    include_when:
      highway:
      - motorway
      - motorway_link
      - trunk
      - trunk_link
      - primary
      - primary_link
      - secondary
      - secondary_link
      - tertiary
      - tertiary_link
      - unclassified
      - residential
      - living_street
      - service
      - pedestrian
      - track
      - footway
      - steps
      - path
      - cycleway
      # TODO should these be aeroway?
      - runway
      - taxiway
      railway:
      - rail
      - narrow_gauge
      - tram
      - light_rail
      - funicular
      - subway
      - monorail
    zoom_override:
    - min: 5
      tag:
        highway: motorway%
    - min: 6
      tag:
        highway: trunk%
    - min: 8
      tag:
        highway: primary%
        # TODO railway={rail/narrow_gauge} AND service=*
    - min: 9
      tag:
        highway: secondary%
    - min: 10
      tag:
        # TODO railway={rail/narrow_gauge} AND service is missing
        railway:
        - funicular
        - light_rail
        - monorail
        - subway
        - tram
        highway: tertiary
    - min: 11
      tag:
        highway: runway # TODO aeroway?
    - min: 12
      tag:
        highway: [ residential, unclassified ]
    attributes:
    - key: kind
      value: ${ match_value.replace('_link', '') }
    - key: link
      min_zoom: 11
      value: true
      include_when:
        highway: '%_link'
      else: false
    - key: rail
      min_zoom: 11
      value: true
      include_when:
        railway: __any__
      else: false
    - key: tunnel
      min_zoom: 11
      value: true
      include_when:
        tunnel: [ yes, building_passage ]
        covered: yes
      else: false
    - key: bridge
      min_zoom: 11
      value: true
      include_when:
        bridge: yes
      else: false
    - key: tracktype
      min_zoom: 11
    - key: surface
      min_zoom: 11
    - key: service
      min_zoom: 11
    - key: bicycle
      min_zoom: 14
    - key: horse
      min_zoom: 14



# TODO street_polygons
# TODO street_labels
# TODO streets_polygons_labels
# TODO streets_labels_points
# TODO aerialways
# TODO public_transport
